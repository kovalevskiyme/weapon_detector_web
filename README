КРАТКИЙ ГАЙД ПО ПОЛЬЗОВАНИЮ ВЕБ-СЕРВИСА

Веб-приложение для детекции опасных предметов на **фото** (ножи/пистолеты и др.) с использованием предобученной модели **OWL-ViT** (zero-shot).  
Функции:
- загрузка изображения и запуск детекции
- визуализация боксов на изображении
- история запросов (JSON)
- экспорт истории в **Excel** и **PDF**
- очистка истории

---

## 1) Что нужно установить

### Обязательно
- **Python 3.10+** (рекомендуется 3.12)
- **pip**
- **Git** (если клонируешь репозиторий)
- **VS Code** (или любой редактор)

### Желательно
- Linux Mint / Ubuntu / Debian (на Windows тоже можно, но проще на Linux)

Проверка Python:
```bash
python3 --version
pip3 --version
````

---

## 2) Как скачать проект

### Вариант A (архив)

1. Скачай ZIP/архив проекта с GitHub/GitLab
2. Распакуй в папку, например:
   `~/VSCode/weapon_detector_web`

### Вариант B (git clone)

```bash
cd ~/VSCode
git clone <ССЫЛКА_НА_РЕПОЗИТОРИЙ>
cd weapon_detector_web
```

---

## 3) Открыть проект в VS Code

1. Открой VS Code
2. **File → Open Folder…**
3. Выбери папку проекта `weapon_detector_web`

---

## 4) Создать виртуальное окружение и поставить зависимости

В терминале внутри папки проекта:

### 4.1 Создаём venv

```bash
python3 -m venv .venv
```

### 4.2 Активируем venv

```bash
source .venv/bin/activate
```

После активации в начале строки терминала появится `(.venv)`.

### 4.3 Обновляем pip

```bash
pip install --upgrade pip
```

### 4.4 Устанавливаем зависимости

```bash
pip install fastapi uvicorn jinja2 python-multipart pillow torch transformers pandas openpyxl reportlab
```

> Примечание: `torch` может устанавливаться дольше — это нормально.

---

## 5) Структура проекта

Примерная структура:

```
weapon_detector_web/
  app/
    main.py
    templates/
      index.html
      history.html
    static/
      uploads/
      results/
  services/
    inference.py
    history.py
    report.py
  data/
    history.json
    reports/
  README.md
```

* `app/main.py` — сервер FastAPI и роуты
* `services/inference.py` — логика детекции (OWL-ViT + ensemble labels)
* `services/history.py` — запись/чтение истории (JSON)
* `services/report.py` — экспорт в Excel/PDF
* `data/history.json` — файл истории
* `data/reports/` — сюда сохраняются отчёты

---

## 6) Запуск сервера

В активированном окружении (`(.venv)`):

```bash
uvicorn app.main:app --reload
```

Открой в браузере:

* Главная: [http://127.0.0.1:8000/](http://127.0.0.1:8000/)
* История: [http://127.0.0.1:8000/history](http://127.0.0.1:8000/history)

Остановить сервер:

* в терминале нажми **Ctrl + C**

---

## 7) Как пользоваться

### 7.1 Детекция

1. Выбери файл изображения
2. В поле **Labels** введи слова (через запятую) — **на английском**
3. Настрой **Threshold**
4. Нажми **Обработать**

### 7.2 Принцип Labels (важно)

Модель **OWL-ViT** работает в режиме **zero-shot** — она ищет объект по тексту.

Примеры:

* Нож: `knife, kitchen knife, blade`
* Пистолет: `pistol, semi-automatic pistol, gun`
* Револьвер: `revolver, pistol, gun`

Внутри проекта используется трюк **ensemble labels**:

* простые слова автоматически расширяются синонимами
* в результатах label “нормализуется” (например показываем `pistol`, если ты его указал)

### 7.3 Threshold

* ниже порог → больше срабатываний (и больше ложных)
* выше порог → меньше ложных, но можно “не найти” объект

Обычно удобно: **0.10 – 0.20**

---

## 8) История и отчёты

### 8.1 История

Открой:
[http://127.0.0.1:8000/history](http://127.0.0.1:8000/history)

Там:

* список последних запросов
* превью результата
* кнопка **Очистить историю**

### 8.2 Экспорт Excel

Кнопка на странице истории или напрямую:
[http://127.0.0.1:8000/export/excel](http://127.0.0.1:8000/export/excel)

Файл: `data/reports/history.xlsx`

### 8.3 Экспорт PDF

Кнопка на странице истории или напрямую:
[http://127.0.0.1:8000/export/pdf](http://127.0.0.1:8000/export/pdf)

Файл: `data/reports/history.pdf`

---

## 9) Частые проблемы

### 9.1 Ошибка с зависимостями

Проверь, что активирован venv:

```bash
source .venv/bin/activate
```

### 9.2 "ModuleNotFoundError"

Ставь зависимости внутри venv:

```bash
pip install <пакет>
```

### 9.3 Модель ничего не находит

* попробуй другие формулировки Labels (например `kitchen knife`)
* уменьши threshold до `0.08–0.12`
* используй качественное изображение (объект крупнее/контрастнее)

