Веб-сервис для детекции опасных предметов на фото (ножи/пистолеты и др.) на базе предобученной модели OWL-ViT в режиме zero-shot.

Возможности

- Загрузка изображения и запуск детекции  
- Визуализация bounding boxes на изображении  
- История запросов (JSON)  
- Экспорт истории в Excel и PDF  
- Очистка истории одной кнопкой  

Быстрый старт (Linux Mint / Ubuntu)

1) Скачать проект

Вариант A — ZIP:
скачай архив → распакуй, например в `~/VSCode/weapon_detector_web`

Вариант B — git clone:
```bash
cd ~/VSCode
git clone <ССЫЛКА_НА_РЕПОЗИТОРИЙ>
cd weapon_detector_web
```

2) Открыть проект в VS Code

VS Code → File → Open Folder… → выбери папку проекта `weapon_detector_web`.

 3) Создать виртуальное окружение и установить зависимости

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install --upgrade pip
pip install fastapi uvicorn jinja2 python-multipart pillow torch transformers pandas openpyxl reportlab
```

> `torch` может устанавливаться дольше — это нормально.

4) Запустить сервер

```bash
uvicorn app.main:app --reload
```

Открыть в браузере:

- Главная: <http://127.0.0.1:8000/>
- История: <http://127.0.0.1:8000/history>

Остановить сервер: Ctrl + C в терминале.

Как пользоваться

Детекция

1. Загрузи изображение (JPG/PNG).  
2. Введи Labels (через запятую, на английском).  
3. Выбери Threshold.  
4. Нажми «Обработать».  
5. Если результат ниже страницы — нажми кнопку «Перейти к результату» (автоскролл к блоку с результатом).

Labels — принцип работы

Модель OWL-ViT — это zero-shot детектор: она ищет объект по текстовым словам, которые ты указываешь в поле `Labels`.

Как правильно писать Labels

- Пиши на английском.  
- Через запятую: `knife, pistol`.  
- Первым ставь самое желаемое слово (то, что хочешь видеть в ответе).  
- Добавляй 2–4 синонима — это часто улучшает детекцию.

Примеры

- Нож:  
  `knife, kitchen knife, blade`  
- Пистолет:  
  `pistol, semi-automatic pistol, gun`  
- Револьвер:  
  `revolver, pistol, gun`

 Ensemble labels (что происходит внутри)

В проекте используется приём ensemble labels:

- простые слова автоматически расширяются синонимами;  
- label в ответе “нормализуется” (например, показываем `pistol`, если пользователь указал `pistol`, даже если сырая модель вернула `handgun`).



 Threshold (порог)

- Ниже порог → больше срабатываний (и больше ложных).  
- Выше порог → меньше ложных, но можно “не найти” объект.

Рекомендуемый диапазон: 0.10 – 0.20.  
Если модель ничего не находит — попробуй 0.08 – 0.12.



 История и отчёты

 История запросов

Адрес: <http://127.0.0.1:8000/history>

На странице:

- список последних запросов,
- превью результата,
- кнопка «Очистить историю» (очищает `data/history.json`).

 Экспорт в Excel

Адрес: <http://127.0.0.1:8000/export/excel>  

Сгенерированный файл также сохраняется в:
`data/reports/history.xlsx`

 Экспорт в PDF

Адрес: <http://127.0.0.1:8000/export/pdf>  

Сгенерированный файл также сохраняется в:
`data/reports/history.pdf`



 Структура проекта

```text
weapon_detector_web/
  app/
    main.py
    templates/
      index.html
      history.html
    static/
      uploads/
      results/
  services/
    inference.py
    history.py
    report.py
  data/
    history.json
    reports/
  README.md
```

Кратко:

- `app/main.py` — сервер FastAPI и роуты.  
- `services/inference.py` — логика детекции (OWL-ViT + ensemble labels + нормализация label).  
- `services/history.py` — запись и чтение истории (JSON).  
- `services/report.py` — экспорт истории в Excel и PDF.  
- `data/history.json` — файл истории запросов.  
- `data/reports/` — папка с сгенерированными отчётами.  



Частые проблемы

 ModuleNotFoundError / пакеты не находятся

Проверь, что venv активирован:

```bash
source .venv/bin/activate
```

Если пакет не установлен — добавь его:

```bash
pip install <имя_пакета>
```

 Модель ничего не находит

- Попробуй более “понятные” формулировки Labels (например `kitchen knife` вместо просто `knife`).  
- Понизь threshold до `0.08–0.12`.  
- Используй более качественное фото (объект крупнее, лучше освещение, меньше шума).

