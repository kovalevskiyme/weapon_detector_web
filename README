# Weapon Detector (Photo MVP) ‚Äî OWL-ViT (zero-shot) + FastAPI

–í–µ–±-—Å–µ—Ä–≤–∏—Å –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –æ–ø–∞—Å–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ **–Ω–∞ —Ñ–æ—Ç–æ** (–Ω–æ–∂–∏/–ø–∏—Å—Ç–æ–ª–µ—Ç—ã –∏ –¥—Ä.) –Ω–∞ –±–∞–∑–µ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ **OWL-ViT** –≤ —Ä–µ–∂–∏–º–µ **zero-shot**.

---

## ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫ –¥–µ—Ç–µ–∫—Ü–∏–∏  
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è **bounding boxes** –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏  
- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (JSON)  
- –≠–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ –≤ **Excel** –∏ **PDF**  
- –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π  

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Linux Mint / Ubuntu)

### 1) –°–∫–∞—á–∞—Ç—å –ø—Ä–æ–µ–∫—Ç

**–í–∞—Ä–∏–∞–Ω—Ç A ‚Äî ZIP:**  
—Å–∫–∞—á–∞–π –∞—Ä—Ö–∏–≤ ‚Üí —Ä–∞—Å–ø–∞–∫—É–π, –Ω–∞–ø—Ä–∏–º–µ—Ä –≤ `~/VSCode/weapon_detector_web`

**–í–∞—Ä–∏–∞–Ω—Ç B ‚Äî git clone:**
```bash
cd ~/VSCode
git clone <–°–°–´–õ–ö–ê_–ù–ê_–†–ï–ü–û–ó–ò–¢–û–†–ò–ô>
cd weapon_detector_web
```

### 2) –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ VS Code

VS Code ‚Üí **File ‚Üí Open Folder‚Ä¶** ‚Üí –≤—ã–±–µ—Ä–∏ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ `weapon_detector_web`.

### 3) –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install --upgrade pip
pip install fastapi uvicorn jinja2 python-multipart pillow torch transformers pandas openpyxl reportlab
```

> `torch` –º–æ–∂–µ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –¥–æ–ª—å—à–µ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.

### 4) –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

```bash
uvicorn app.main:app --reload
```

–û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

- –ì–ª–∞–≤–Ω–∞—è: <http://127.0.0.1:8000/>
- –ò—Å—Ç–æ—Ä–∏—è: <http://127.0.0.1:8000/history>

–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä: **Ctrl + C** –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.

---

## üß≠ –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è

### –î–µ—Ç–µ–∫—Ü–∏—è

1. –ó–∞–≥—Ä—É–∑–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (JPG/PNG).  
2. –í–≤–µ–¥–∏ **Labels** (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, **–Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º**).  
3. –í—ã–±–µ—Ä–∏ **Threshold**.  
4. –ù–∞–∂–º–∏ **¬´–û–±—Ä–∞–±–æ—Ç–∞—Ç—å¬ª**.  
5. –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∏–∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É **¬´–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É¬ª** (–∞–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –∫ –±–ª–æ–∫—É —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º).

---

## üè∑Ô∏è Labels ‚Äî –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

–ú–æ–¥–µ–ª—å **OWL-ViT** ‚Äî —ç—Ç–æ **zero-shot** –¥–µ—Ç–µ–∫—Ç–æ—Ä: –æ–Ω–∞ –∏—â–µ—Ç –æ–±—ä–µ–∫—Ç **–ø–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Å–ª–æ–≤–∞–º**, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã —É–∫–∞–∑—ã–≤–∞–µ—à—å –≤ –ø–æ–ª–µ `Labels`.

### –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–∏—Å–∞—Ç—å Labels

- –ü–∏—à–∏ **–Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º**.  
- –ß–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é: `knife, pistol`.  
- –ü–µ—Ä–≤—ã–º —Å—Ç–∞–≤—å **—Å–∞–º–æ–µ –∂–µ–ª–∞–µ–º–æ–µ** —Å–ª–æ–≤–æ (—Ç–æ, —á—Ç–æ —Ö–æ—á–µ—à—å –≤–∏–¥–µ—Ç—å –≤ –æ—Ç–≤–µ—Ç–µ).  
- –î–æ–±–∞–≤–ª—è–π 2‚Äì4 —Å–∏–Ω–æ–Ω–∏–º–∞ ‚Äî —ç—Ç–æ —á–∞—Å—Ç–æ —É–ª—É—á—à–∞–µ—Ç –¥–µ—Ç–µ–∫—Ü–∏—é.

### –ü—Ä–∏–º–µ—Ä—ã

- –ù–æ–∂:  
  `knife, kitchen knife, blade`  
- –ü–∏—Å—Ç–æ–ª–µ—Ç:  
  `pistol, semi-automatic pistol, gun`  
- –†–µ–≤–æ–ª—å–≤–µ—Ä:  
  `revolver, pistol, gun`

### Ensemble labels (—á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏)

–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏—ë–º **ensemble labels**:

- –ø—Ä–æ—Å—Ç—ã–µ —Å–ª–æ–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—à–∏—Ä—è—é—Ç—Å—è —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏;  
- label –≤ –æ—Ç–≤–µ—Ç–µ ‚Äú–Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è‚Äù (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `pistol`, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑–∞–ª `pistol`, –¥–∞–∂–µ –µ—Å–ª–∏ —Å—ã—Ä–∞—è –º–æ–¥–µ–ª—å –≤–µ—Ä–Ω—É–ª–∞ `handgun`).

---

## üéöÔ∏è Threshold (–ø–æ—Ä–æ–≥)

- –ù–∏–∂–µ –ø–æ—Ä–æ–≥ ‚Üí –±–æ–ª—å—à–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π (–∏ –±–æ–ª—å—à–µ –ª–æ–∂–Ω—ã—Ö).  
- –í—ã—à–µ –ø–æ—Ä–æ–≥ ‚Üí –º–µ–Ω—å—à–µ –ª–æ–∂–Ω—ã—Ö, –Ω–æ –º–æ–∂–Ω–æ ‚Äú–Ω–µ –Ω–∞–π—Ç–∏‚Äù –æ–±—ä–µ–∫—Ç.

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω: **0.10 ‚Äì 0.20**.  
–ï—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç ‚Äî –ø–æ–ø—Ä–æ–±—É–π **0.08 ‚Äì 0.12**.

---

## üóÇÔ∏è –ò—Å—Ç–æ—Ä–∏—è –∏ –æ—Ç—á—ë—Ç—ã

### –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

–ê–¥—Ä–µ—Å: <http://127.0.0.1:8000/history>

–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:

- —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤,
- –ø—Ä–µ–≤—å—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞,
- –∫–Ω–æ–ø–∫–∞ **¬´–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é¬ª** (–æ—á–∏—â–∞–µ—Ç `data/history.json`).

### –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel

–ê–¥—Ä–µ—Å: <http://127.0.0.1:8000/export/excel>  

–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª —Ç–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤:
`data/reports/history.xlsx`

### –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF

–ê–¥—Ä–µ—Å: <http://127.0.0.1:8000/export/pdf>  

–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª —Ç–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤:
`data/reports/history.pdf`

---

## üß± –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
weapon_detector_web/
  app/
    main.py
    templates/
      index.html
      history.html
    static/
      uploads/
      results/
  services/
    inference.py
    history.py
    report.py
  data/
    history.json
    reports/
  README.md
```

–ö—Ä–∞—Ç–∫–æ:

- `app/main.py` ‚Äî —Å–µ—Ä–≤–µ—Ä FastAPI –∏ —Ä–æ—É—Ç—ã.  
- `services/inference.py` ‚Äî –ª–æ–≥–∏–∫–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏ (OWL-ViT + ensemble labels + –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è label).  
- `services/history.py` ‚Äî –∑–∞–ø–∏—Å—å –∏ —á—Ç–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ (JSON).  
- `services/report.py` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ –≤ Excel –∏ PDF.  
- `data/history.json` ‚Äî —Ñ–∞–π–ª –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤.  
- `data/reports/` ‚Äî –ø–∞–ø–∫–∞ —Å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –æ—Ç—á—ë—Ç–∞–º–∏.  

---

## üßØ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ModuleNotFoundError / –ø–∞–∫–µ—Ç—ã –Ω–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ venv –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω:

```bash
source .venv/bin/activate
```

–ï—Å–ª–∏ –ø–∞–∫–µ—Ç –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Äî –¥–æ–±–∞–≤—å –µ–≥–æ:

```bash
pip install <–∏–º—è_–ø–∞–∫–µ—Ç–∞>
```

### –ú–æ–¥–µ–ª—å –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç

- –ü–æ–ø—Ä–æ–±—É–π –±–æ–ª–µ–µ ‚Äú–ø–æ–Ω—è—Ç–Ω—ã–µ‚Äù —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ Labels (–Ω–∞–ø—Ä–∏–º–µ—Ä `kitchen knife` –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ `knife`).  
- –ü–æ–Ω–∏–∑—å threshold –¥–æ `0.08‚Äì0.12`.  
- –ò—Å–ø–æ–ª—å–∑—É–π –±–æ–ª–µ–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ñ–æ—Ç–æ (–æ–±—ä–µ–∫—Ç –∫—Ä—É–ø–Ω–µ–µ, –ª—É—á—à–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ, –º–µ–Ω—å—à–µ —à—É–º–∞).

